<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Term API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e9; border-left: 4px solid #4caf50; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        button { background: #2196f3; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 3px; cursor: pointer; }
        button:hover { background: #1976d2; }
    </style>
</head>
<body>
    <h1>Payment Term API Test</h1>
    
    <button onclick="testPaymentTermAPI()">Test Payment Term API</button>
    <button onclick="testDirectMethod()">Test Direct Method</button>
    
    <div id="results"></div>

    <script>
        function addResult(title, content, isSuccess = true) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }

        function testPaymentTermAPI() {
            addResult('Testing...', 'Fetching payment terms from API endpoint...');
            
            fetch('./payterm/list_term.php?limit=10')
                .then(response => {
                    console.log('Response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API Response:', data);
                    
                    let resultText = `Success: ${data.success}\n`;
                    resultText += `Message: ${data.message}\n`;
                    
                    if (data.success && data.data) {
                        if (data.data.paymentTerms && data.data.paymentTerms.d) {
                            resultText += `Payment Terms Found: ${data.data.paymentTerms.d.length}\n\n`;
                            resultText += 'Sample Payment Terms:\n';
                            data.data.paymentTerms.d.slice(0, 3).forEach((term, index) => {
                                resultText += `${index + 1}. Name: ${term.name}, Due Days: ${term.dueDays}, Suspended: ${term.suspended}\n`;
                            });
                        } else {
                            resultText += 'No payment terms found in expected structure\n';
                            resultText += 'Data structure:\n' + JSON.stringify(data.data, null, 2);
                        }
                    } else {
                        resultText += `Error: ${data.message || 'Unknown error'}\n`;
                    }
                    
                    addResult('Payment Term API Test Result', resultText, data.success);
                })
                .catch(error => {
                    console.error('API Error:', error);
                    addResult('Payment Term API Test Error', `Error: ${error.message}`, false);
                });
        }

        function testDirectMethod() {
            addResult('Testing...', 'Testing direct AccurateAPI method...');
            
            // This would need to be implemented as a separate PHP endpoint
            // For now, just show that we would test it
            addResult('Direct Method Test', 'This test requires server-side implementation.\nThe getPaymentTermList method has been added to AccurateAPI class.', true);
        }

        // Auto-run test on page load
        window.onload = function() {
            testPaymentTermAPI();
        };
    </script>
</body>
</html>